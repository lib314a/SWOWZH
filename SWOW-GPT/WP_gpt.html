<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2024-05-08 Wed 02:30 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="author" content="LI" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>

<style>
.ai {background-color:#eea23655;font-family:courier;}
.sidenotes {float:right; clear:right; background-color:#5cb85c55; width: 200px;}
</style>
</head>
<body>
<div id="content" class="content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orge16b115">1. GPT word association task</a></li>
</ul>
</div>
</div>

<div id="outline-container-orge16b115" class="outline-2">
<h2 id="orge16b115"><span class="section-number-2">1.</span> GPT word association task</h2>
<div class="outline-text-2" id="text-1">
<p>
Set up OpenAI configurations 
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b6a0ff;">import</span> openai
openai.<span style="color: #00d3d0;">api_key</span> = api_key
</pre>
</div>

<p>
Read the cue words:
</p>
<div class="org-src-container">
<pre class="src src-python" id="org79e2e1e"><span style="color: #b6a0ff;">import</span> numpy <span style="color: #b6a0ff;">as</span> np
<span style="color: #b6a0ff;">import</span> random 

<span style="color: #a8a8a8;"># </span><span style="color: #a8a8a8;">Open the file</span>
<span style="color: #b6a0ff;">with</span> <span style="color: #f78fe7;">open</span>(
    <span style="color: #a8a8a8;">##</span><span style="color: #a8a8a8;">"./ap-data-management-OUT-cue-list.txt",</span>
    <span style="color: #a8a8a8;">##</span><span style="color: #a8a8a8;">"./ap-data-management-OUT-abstract-concrete-words.txt",</span>
    <span style="color: #79a8ff;">"./data/164words.txt"</span>,
    <span style="color: #79a8ff;">"r"</span>) <span style="color: #b6a0ff;">as</span> <span style="color: #f78fe7;">file</span>:
  <span style="color: #a8a8a8;">## </span><span style="color: #a8a8a8;">Split text file by character </span>
  <span style="color: #00d3d0;">data</span> = <span style="color: #f78fe7;">file</span>.read()
  <span style="color: #00d3d0;">CUES</span> = [i <span style="color: #b6a0ff;">for</span> i <span style="color: #b6a0ff;">in</span> data.split (<span style="color: #79a8ff;">"</span><span style="color: #00bcff;">\n</span><span style="color: #79a8ff;">"</span>) <span style="color: #b6a0ff;">if</span> i != <span style="color: #79a8ff;">""</span>]

<span style="color: #a8a8a8;">##</span><span style="color: #a8a8a8;">CUES = np.repeat (CUES, 50)</span>
<span style="color: #a8a8a8;">##</span><span style="color: #a8a8a8;">RANDOMSTATE = random.getstate ()</span>
<span style="color: #00d3d0;">CUES</span> = [j <span style="color: #b6a0ff;">for</span> i <span style="color: #b6a0ff;">in</span> [ random.sample (CUES, <span style="color: #f78fe7;">len</span> (CUES)) <span style="color: #b6a0ff;">for</span> i <span style="color: #b6a0ff;">in</span> <span style="color: #f78fe7;">range</span>(120) ] <span style="color: #b6a0ff;">for</span> j <span style="color: #b6a0ff;">in</span> i ]

<span style="color: #a8a8a8;">##</span><span style="color: #a8a8a8;">CHUNK_SIZE = 1000</span>
<span style="color: #a8a8a8;">##</span><span style="color: #a8a8a8;">CUES = CUES[(len (CUES) - 2000):(len (CUES))]</span>
<span style="color: #a8a8a8;">##</span><span style="color: #a8a8a8;">CUES = [CUES[i:i+1000] for i in range(0, len(CUES), CHUNK_SIZE)]</span>
</pre>
</div>

<p>
Define the class for obtaining and saving the responses from GPT.
The original instruction for GPT, in Chinese, was: 
</p>
<blockquote>
<p>
我会给你一个词或者字。看到我给你的词或者字以后，输入你的脑海里没有经过思考就浮现出来的三个词语或者字,用半角逗号隔开。注意，只给出词或字即可，不要解释，不要添加多余信息。线索词是：XXX
</p>
</blockquote>
<p>
And the translation in English was:
</p>
<blockquote>
<p>
I will give you a word or character. After seeing the word or character I give you, enter the first three words or characters that come to mind without thinking, separated by commas. Note, only give the word or character, do not explain, do not add extra information. The cue word is: XXX
</p>
</blockquote>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b6a0ff;">import</span> time, warnings, pickle, csv

<span style="color: #b6a0ff;">class</span> <span style="color: #6ae4b9;">Gpta</span>:

  <span style="color: #b6a0ff;">def</span> <span style="color: #feacd0;">__init__</span>(<span style="color: #b6a0ff;">self</span>, data, log, results):
    <span style="color: #b6a0ff;">self</span>.<span style="color: #00d3d0;">log</span> = log
    <span style="color: #b6a0ff;">self</span>.<span style="color: #00d3d0;">results</span> = results
    <span style="color: #b6a0ff;">self</span>.<span style="color: #00d3d0;">data</span> = data
    <span style="color: #b6a0ff;">self</span>.<span style="color: #00d3d0;">cue</span> = []
    <span style="color: #b6a0ff;">self</span>.<span style="color: #00d3d0;">temp</span> = 1.5
    <span style="color: #b6a0ff;">self</span>.<span style="color: #00d3d0;">maxtokens</span> = 100
    <span style="color: #b6a0ff;">self</span>.<span style="color: #00d3d0;">freqpenalty</span> = 1.0

  <span style="color: #a8a8a8;">##</span><span style="color: #a8a8a8;">def misajour (self):</span>
  <span style="color: #a8a8a8;">##  </span><span style="color: #a8a8a8;">## Get the first column of a CSV file with vanilla Python</span>
  <span style="color: #a8a8a8;">##  </span><span style="color: #a8a8a8;">with open(self.log, 'r') as csvfile:</span>
  <span style="color: #a8a8a8;">##    </span><span style="color: #a8a8a8;">csvreader = csv.reader(csvfile) </span>
  <span style="color: #a8a8a8;">##    </span><span style="color: #a8a8a8;">self.cues = [row[0] for row in csvreader]</span>

  <span style="color: #b6a0ff;">def</span> <span style="color: #feacd0;">gpt_associations</span> (<span style="color: #b6a0ff;">self</span>, cue, model = <span style="color: #79a8ff;">"gpt-3.5-turbo"</span>):
    <span style="color: #a8a8a8;">##</span><span style="color: #a8a8a8;">time.sleep (.5)</span>
    <span style="color: #00d3d0;">message</span> = [{
      <span style="color: #79a8ff;">"role"</span>: <span style="color: #79a8ff;">"user"</span>,
      <span style="color: #79a8ff;">"content"</span>: <span style="color: #79a8ff;">"&#25105;&#20250;&#32473;&#20320;&#19968;&#20010;&#35789;&#25110;&#32773;&#23383;&#12290;&#30475;&#21040;&#25105;&#32473;&#20320;&#30340;&#35789;&#25110;&#32773;&#23383;&#20197;&#21518;&#65292;&#36755;&#20837;&#20320;&#30340;&#33041;&#28023;&#37324;&#27809;&#26377;&#32463;&#36807;&#24605;&#32771;&#23601;&#28014;&#29616;&#20986;&#26469;&#30340;&#19977;&#20010;&#35789;&#35821;&#25110;&#32773;&#23383;,&#29992;&#21322;&#35282;&#36887;&#21495;&#38548;&#24320;&#12290;&#27880;&#24847;&#65292;&#21482;&#32473;&#20986;&#35789;&#25110;&#23383;&#21363;&#21487;&#65292;&#19981;&#35201;&#35299;&#37322;&#65292;&#19981;&#35201;&#28155;&#21152;&#22810;&#20313;&#20449;&#24687;&#12290;"</span> +
      <span style="color: #79a8ff;">"&#32447;&#32034;&#35789;&#26159;&#65306;"</span> + cue + <span style="color: #79a8ff;">"&#12290;"</span>}]
    <span style="color: #00d3d0;">response</span> = openai.ChatCompletion.create(
      model = model,
      messages = message,
      temperature=<span style="color: #b6a0ff;">self</span>.temp,
      max_tokens=<span style="color: #b6a0ff;">self</span>.maxtokens,
      frequency_penalty=<span style="color: #b6a0ff;">self</span>.freqpenalty,
      stream = <span style="color: #00bcff;">False</span>
    )

    <span style="color: #b6a0ff;">self</span>.cue.append (cue)

    <span style="color: #b6a0ff;">with</span> <span style="color: #f78fe7;">open</span>(<span style="color: #b6a0ff;">self</span>.log, <span style="color: #79a8ff;">'a'</span>) <span style="color: #b6a0ff;">as</span> <span style="color: #f78fe7;">file</span>:
      <span style="color: #a8a8a8;">## </span><span style="color: #a8a8a8;">Append texts to file </span>
      <span style="color: #f78fe7;">file</span>.write (
        cue +
        <span style="color: #79a8ff;">","</span> +
        response[<span style="color: #79a8ff;">"choices"</span>][0][<span style="color: #79a8ff;">"message"</span>][<span style="color: #79a8ff;">"content"</span>].replace (<span style="color: #79a8ff;">"</span><span style="color: #00bcff;">\n</span><span style="color: #79a8ff;">"</span>, <span style="color: #79a8ff;">""</span>) +
        <span style="color: #79a8ff;">"</span><span style="color: #00bcff;">\n</span><span style="color: #79a8ff;">"</span>
      )

    <span style="color: #a8a8a8;">## </span><span style="color: #a8a8a8;">Append dictionary to list </span>
    <span style="color: #b6a0ff;">self</span>.results.append({
      <span style="color: #79a8ff;">"cue"</span>:cue,
      <span style="color: #79a8ff;">"model"</span>: model,
      <span style="color: #79a8ff;">"message"</span>: message,
      <span style="color: #79a8ff;">"response"</span>: response,
      <span style="color: #79a8ff;">"temperature"</span>: <span style="color: #b6a0ff;">self</span>.temp,
      <span style="color: #79a8ff;">"max_tokens"</span>: <span style="color: #b6a0ff;">self</span>.maxtokens,
      <span style="color: #79a8ff;">"frequency_penalty"</span>: <span style="color: #b6a0ff;">self</span>.freqpenalty,
    })

    <span style="color: #a8a8a8;">## </span><span style="color: #a8a8a8;">Save results to a pickle file</span>
    <span style="color: #b6a0ff;">with</span> <span style="color: #f78fe7;">open</span>(<span style="color: #b6a0ff;">self</span>.data, <span style="color: #79a8ff;">'wb'</span>) <span style="color: #b6a0ff;">as</span> <span style="color: #f78fe7;">file</span>:
      <span style="color: #a8a8a8;">## </span><span style="color: #a8a8a8;">Dump the data into the file</span>
      pickle.dump(<span style="color: #b6a0ff;">self</span>.results, <span style="color: #f78fe7;">file</span>)

    <span style="color: #f78fe7;">print</span>(<span style="color: #79a8ff;">"Fetched and saved cue: "</span> + cue)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #00d3d0;">gpta</span> = Gpta (
  data = <span style="color: #79a8ff;">"WP_gpt-OUT-ac-words-results-gpt3.pkl"</span>,
  log = <span style="color: #79a8ff;">"WP_gpt-OUT-ac-words-log-gpt3.txt"</span>,
  <span style="color: #a8a8a8;">##</span><span style="color: #a8a8a8;">data = "WP_gpt-OUT-response-results-gpt3-1.pkl",</span>
  <span style="color: #a8a8a8;">##</span><span style="color: #a8a8a8;">log = "WP_gpt-OUT-response-log-gpt3-1.txt",</span>
  results = []
)
</pre>
</div>

<p>
And we used the following codes to loop the cues to get GPT responses:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #00d3d0;">k</span> = 0
<span style="color: #b6a0ff;">for</span> i <span style="color: #b6a0ff;">in</span> CUES:
  <span style="color: #b6a0ff;">if</span> i <span style="color: #b6a0ff;">in</span> gpta.cues:
    <span style="color: #f78fe7;">next</span>
  <span style="color: #b6a0ff;">else</span>:
    gpta.gpt_associations (i)
    gpta.misajour ()

  <span style="color: #00d3d0;">k</span>+=1
  <span style="color: #b6a0ff;">if</span> k &gt;= 10023:
    <span style="color: #b6a0ff;">break</span>
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: LI</p>
<p class="date">Created: 2024-05-08 Wed 02:30</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
